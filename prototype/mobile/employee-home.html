<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‘˜å·¥é¦–é¡µ - ä»“åº“ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../assets/css/mobile-common.css">
</head>
<body>
    <div class="mobile-container">
        <!-- å¯¼èˆªæ  -->
        <div class="navbar">
            <div class="navbar-title">ç‰©èµ„ç”³è¯·</div>
        </div>

        <!-- é¡µé¢å†…å®¹ -->
        <div class="page">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stat-grid">
                <div class="stat-item" onclick="filterApplies(0)">
                    <div class="stat-icon" style="color: #ff976a;">â³</div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">å¾…å®¡æ‰¹</div>
                </div>
                <div class="stat-item" onclick="filterApplies(1)">
                    <div class="stat-icon" style="color: #07c160;">âœ“</div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">å·²é€šè¿‡</div>
                </div>
                <div class="stat-item" onclick="filterApplies(3)">
                    <div class="stat-icon" style="color: #1989fa;">ğŸ“¦</div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="stat-item" onclick="filterApplies(2)">
                    <div class="stat-icon" style="color: #ee0a24;">âœ—</div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">å·²æ‹’ç»</div>
                </div>
            </div>

            <!-- å¿«æ·ç”³è¯·æŒ‰é’® -->
            <div style="padding: 0 12px; margin-bottom: 12px;">
                <button class="btn btn-primary" onclick="location.href='apply-create.html'" style="height: 48px;">
                    + æ–°å»ºç‰©èµ„ç”³è¯·
                </button>
            </div>

            <!-- æˆ‘çš„ç”³è¯· -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div class="card-title" style="margin: 0;">æˆ‘çš„ç”³è¯·</div>
                    <a href="apply-list.html" style="color: #1989fa; font-size: 14px; text-decoration: none;">æŸ¥çœ‹å…¨éƒ¨ ></a>
                </div>

                <!-- ç­›é€‰ -->
                <div class="filter-bar" style="margin: 0 -16px 12px -16px; padding: 12px 16px;">
                    <div class="filter-tab active" onclick="filterApplies(null)">å…¨éƒ¨</div>
                    <div class="filter-tab" onclick="filterApplies(0)">å¾…å®¡æ‰¹</div>
                    <div class="filter-tab" onclick="filterApplies(1)">å·²é€šè¿‡</div>
                    <div class="filter-tab" onclick="filterApplies(2)">å·²æ‹’ç»</div>
                </div>

                <div class="list" id="applyList"></div>
            </div>

            <!-- æ¶ˆæ¯é€šçŸ¥ -->
            <div class="card">
                <div class="card-title">æ¶ˆæ¯é€šçŸ¥</div>
                <div class="list" id="messageList"></div>
            </div>
        </div>

        <!-- TabBar -->
        <div class="tabbar">
            <div class="tabbar-item active" onclick="location.href='employee-home.html'">
                <div class="tabbar-icon">ğŸ </div>
                <div class="tabbar-text">é¦–é¡µ</div>
            </div>
            <div class="tabbar-item" onclick="location.href='apply-list.html'">
                <div class="tabbar-icon">ğŸ“</div>
                <div class="tabbar-text">æˆ‘çš„ç”³è¯·</div>
            </div>
            <div class="tabbar-item" onclick="location.href='inventory-list.html'">
                <div class="tabbar-icon">ğŸ“Š</div>
                <div class="tabbar-text">åº“å­˜</div>
            </div>
            <div class="tabbar-item" onclick="Toast.show('æˆ‘çš„')">
                <div class="tabbar-icon">ğŸ‘¤</div>
                <div class="tabbar-text">æˆ‘çš„</div>
            </div>
        </div>
    </div>

    <script src="../assets/js/mock-data.js"></script>
    <script src="../assets/js/common.js"></script>
    <script>
        let currentFilter = null;

        // æ¸²æŸ“ç”³è¯·åˆ—è¡¨
        function renderApplyList(status = null) {
            const applyList = document.getElementById('applyList');

            // ç­›é€‰å½“å‰ç”¨æˆ·çš„ç”³è¯·ï¼ˆè¿™é‡Œå‡è®¾å½“å‰ç”¨æˆ·IDä¸º3ï¼‰
            let data = mockData.applyList.filter(a => a.applyUserId === 3);

            if (status !== null) {
                data = data.filter(a => a.status === status);
            }

            let html = '';

            data.slice(0, 5).forEach(item => {
                html += `
                    <div class="list-item" onclick="showApplyDetail('${item.code}')">
                        <div class="list-header">
                            <div class="list-title">${item.code}</div>
                            ${getStatusTag(item.status, item.statusText, 'apply')}
                        </div>
                        <div class="list-info">${item.purpose}</div>
                        <div class="list-meta">
                            <span>${item.itemCount}ç§ç‰©èµ„ | ${formatMoney(item.totalAmount)}</span>
                            <span>${formatDateTime(item.applyTime)}</span>
                        </div>
                    </div>
                `;
            });

            if (data.length === 0) {
                html = '<div class="empty-state"><div class="empty-icon">ğŸ“­</div><div class="empty-text">æš‚æ— ç”³è¯·è®°å½•</div></div>';
            }

            applyList.innerHTML = html;
        }

        // ç­›é€‰ç”³è¯·
        function filterApplies(status) {
            currentFilter = status;
            renderApplyList(status);

            // æ›´æ–°ç­›é€‰æŒ‰é’®æ ·å¼
            const filterTabs = document.querySelectorAll('.filter-tab');
            filterTabs.forEach((tab, i) => {
                const tabStatuses = [null, 0, 1, 2];
                tab.className = 'filter-tab' + (tabStatuses[i] === status ? ' active' : '');
            });
        }

        // æ˜¾ç¤ºç”³è¯·è¯¦æƒ…
        function showApplyDetail(code) {
            Toast.show('è·³è½¬åˆ°ç”³è¯·è¯¦æƒ…é¡µ');
        }

        // æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨
        function renderMessageList() {
            const messageList = document.getElementById('messageList');

            // ç­›é€‰ä¸å½“å‰ç”¨æˆ·ç›¸å…³çš„æ¶ˆæ¯
            const messages = mockData.notifications.filter(n => !n.read);

            let html = '';

            messages.slice(0, 3).forEach(msg => {
                const icon = msg.type === 'approval' ? 'âœ“' : (msg.type === 'stock' ? 'âš ï¸' : 'â„¹ï¸');
                html += `
                    <div class="list-item">
                        <div class="list-header">
                            <div class="list-title">${icon} ${msg.title}</div>
                        </div>
                        <div class="list-info">${msg.content}</div>
                        <div class="list-meta">
                            <span>${formatDateTime(msg.time)}</span>
                        </div>
                    </div>
                `;
            });

            if (messages.length === 0) {
                html = '<div class="empty-state"><div class="empty-icon">âœ“</div><div class="empty-text">æš‚æ— æ–°æ¶ˆæ¯</div></div>';
            }

            messageList.innerHTML = html;
        }

        function init() {
            renderApplyList();
            renderMessageList();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
