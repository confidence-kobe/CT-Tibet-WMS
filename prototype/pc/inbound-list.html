<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¥åº“ç®¡ç† - è¥¿è—ç”µä¿¡ä»“åº“ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../assets/css/pc-common.css">
</head>
<body>
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">ğŸ“¦</div>
                <div class="sidebar-title">ä»“åº“ç®¡ç†ç³»ç»Ÿ</div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-item" onclick="location.href='dashboard.html'">
                    <span class="menu-item-icon">ğŸ </span>
                    <span>å·¥ä½œå°</span>
                </div>
                <div class="menu-item active">
                    <span class="menu-item-icon">ğŸ“¥</span>
                    <span>å…¥åº“ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="location.href='outbound-list.html'">
                    <span class="menu-item-icon">ğŸ“¤</span>
                    <span>å‡ºåº“ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="location.href='approval-list.html'">
                    <span class="menu-item-icon">âœ“</span>
                    <span>å®¡æ‰¹ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="location.href='inventory-list.html'">
                    <span class="menu-item-icon">ğŸ“Š</span>
                    <span>åº“å­˜æŸ¥è¯¢</span>
                </div>
                <div class="menu-item" onclick="location.href='stats.html'">
                    <span class="menu-item-icon">ğŸ“ˆ</span>
                    <span>ç»Ÿè®¡æŠ¥è¡¨</span>
                </div>
            </nav>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="top-header">
                <div class="header-left">
                    <div class="breadcrumb">
                        <span class="breadcrumb-item">å…¥åº“ç®¡ç†</span>
                        <span>/</span>
                        <span class="breadcrumb-item active">å…¥åº“å•åˆ—è¡¨</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-btn">
                        <span>ğŸ””</span>
                        <span class="notification-badge">2</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar">å¼ </div>
                        <span>å¼ ä¸‰</span>
                    </div>
                </div>
            </header>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content-wrapper">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">å…¥åº“å•åˆ—è¡¨</div>
                        <button class="btn btn-primary" onclick="location.href='inbound-create.html'">
                            + æ–°å»ºå…¥åº“
                        </button>
                    </div>

                    <!-- æœç´¢æ  -->
                    <div class="table-toolbar">
                        <div class="search-box">
                            <input type="text" class="form-input search-input" placeholder="æœç´¢å•æ®ç¼–å·ã€å¤‡æ³¨..." id="searchInput">
                            <button class="btn btn-default" onclick="handleSearch()">æœç´¢</button>
                        </div>
                        <div>
                            <button class="btn btn-default" onclick="handleExport()">å¯¼å‡ºExcel</button>
                        </div>
                    </div>

                    <!-- è¡¨æ ¼ -->
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>å…¥åº“å•å·</th>
                                <th>ä»“åº“åç§°</th>
                                <th>ç‰©èµ„ç§ç±»</th>
                                <th>å…¥åº“é‡‘é¢</th>
                                <th>åˆ›å»ºäºº</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>å¤‡æ³¨</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <!-- åˆ†é¡µ -->
                    <div id="pagination"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="../assets/js/mock-data.js"></script>
    <script src="../assets/js/common.js"></script>
    <script>
        let currentData = [...mockData.inboundList];
        let pagination = null;

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data) {
            const tbody = document.querySelector('#dataTable tbody');
            let html = '';

            data.forEach(item => {
                html += `
                    <tr>
                        <td><a href="#" class="text-primary" onclick="showDetail('${item.code}'); return false;">${item.code}</a></td>
                        <td>${item.warehouseName}</td>
                        <td>${item.itemCount}</td>
                        <td class="text-danger">${formatMoney(item.totalAmount)}</td>
                        <td>${item.createUser}</td>
                        <td>${formatDateTime(item.createTime)}</td>
                        <td>${item.remark || '-'}</td>
                        <td>
                            <button class="btn btn-text" onclick="showDetail('${item.code}')">æŸ¥çœ‹è¯¦æƒ…</button>
                        </td>
                    </tr>
                `;
            });

            if (data.length === 0) {
                html = '<tr><td colspan="8"><div class="empty-state"><div class="empty-icon">ğŸ“­</div><div class="empty-text">æš‚æ— æ•°æ®</div></div></td></tr>';
            }

            tbody.innerHTML = html;
        }

        // æ˜¾ç¤ºè¯¦æƒ…
        function showDetail(code) {
            const item = mockData.inboundList.find(i => i.code === code);
            if (!item) return;

            let detailsHtml = '<table style="width: 100%; font-size: 14px; margin-top: 16px;"><thead><tr><th>ç‰©èµ„ç¼–ç </th><th>ç‰©èµ„åç§°</th><th>è§„æ ¼å‹å·</th><th>æ•°é‡</th><th>å•ä»·</th><th>é‡‘é¢</th></tr></thead><tbody>';

            item.details.forEach(d => {
                detailsHtml += `
                    <tr>
                        <td>${d.materialCode}</td>
                        <td>${d.materialName}</td>
                        <td>${d.spec}</td>
                        <td>${d.quantity}</td>
                        <td>${formatMoney(d.price)}</td>
                        <td class="text-danger">${formatMoney(d.amount)}</td>
                    </tr>
                `;
            });

            detailsHtml += '</tbody></table>';

            const content = `
                <div style="font-size: 14px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                        <div><strong>å…¥åº“å•å·ï¼š</strong>${item.code}</div>
                        <div><strong>ä»“åº“åç§°ï¼š</strong>${item.warehouseName}</div>
                        <div><strong>åˆ›å»ºäººï¼š</strong>${item.createUser}</div>
                        <div><strong>åˆ›å»ºæ—¶é—´ï¼š</strong>${formatDateTime(item.createTime)}</div>
                        <div><strong>ç‰©èµ„ç§ç±»ï¼š</strong>${item.itemCount}</div>
                        <div><strong>å…¥åº“é‡‘é¢ï¼š</strong><span class="text-danger">${formatMoney(item.totalAmount)}</span></div>
                        <div style="grid-column: 1 / -1;"><strong>å¤‡æ³¨ï¼š</strong>${item.remark || '-'}</div>
                    </div>
                    <div style="border-top: 1px solid #f0f0f0; padding-top: 16px;">
                        <strong>å…¥åº“æ˜ç»†ï¼š</strong>
                        ${detailsHtml}
                    </div>
                </div>
            `;

            showDetailModal('å…¥åº“å•è¯¦æƒ…', content);
        }

        // æœç´¢
        function handleSearch() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            if (!keyword) {
                currentData = [...mockData.inboundList];
            } else {
                currentData = mockData.inboundList.filter(item =>
                    item.code.toLowerCase().includes(keyword) ||
                    item.warehouseName.toLowerCase().includes(keyword) ||
                    (item.remark && item.remark.toLowerCase().includes(keyword))
                );
            }

            // é‡æ–°åˆ›å»ºåˆ†é¡µ
            pagination = new Pagination(
                document.getElementById('pagination'),
                currentData.length,
                10,
                (page, pageSize) => {
                    const start = (page - 1) * pageSize;
                    const end = start + pageSize;
                    renderTable(currentData.slice(start, end));
                }
            );

            renderTable(currentData.slice(0, 10));
        }

        // å¯¼å‡º
        function handleExport() {
            exportToExcel(currentData, 'å…¥åº“å•åˆ—è¡¨');
        }

        // åˆå§‹åŒ–
        function init() {
            renderTable(mockData.inboundList);

            pagination = new Pagination(
                document.getElementById('pagination'),
                mockData.inboundList.length,
                10,
                (page, pageSize) => {
                    const start = (page - 1) * pageSize;
                    const end = start + pageSize;
                    renderTable(currentData.slice(start, end));
                }
            );
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
