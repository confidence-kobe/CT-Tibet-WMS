<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“ç®¡å‘˜å·¥ä½œå° - è¥¿è—ç”µä¿¡ä»“åº“ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../assets/css/pc-common.css">
</head>
<body>
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">ğŸ“¦</div>
                <div class="sidebar-title">ä»“åº“ç®¡ç†ç³»ç»Ÿ</div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-item active">
                    <span class="menu-item-icon">ğŸ </span>
                    <span>å·¥ä½œå°</span>
                </div>
                <div class="menu-item" onclick="location.href='inbound-list.html'">
                    <span class="menu-item-icon">ğŸ“¥</span>
                    <span>å…¥åº“ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="location.href='outbound-list.html'">
                    <span class="menu-item-icon">ğŸ“¤</span>
                    <span>å‡ºåº“ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="location.href='approval-list.html'">
                    <span class="menu-item-icon">âœ“</span>
                    <span>å®¡æ‰¹ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="location.href='inventory-list.html'">
                    <span class="menu-item-icon">ğŸ“Š</span>
                    <span>åº“å­˜æŸ¥è¯¢</span>
                </div>
                <div class="menu-item" onclick="location.href='stats.html'">
                    <span class="menu-item-icon">ğŸ“ˆ</span>
                    <span>ç»Ÿè®¡æŠ¥è¡¨</span>
                </div>
            </nav>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="top-header">
                <div class="header-left">
                    <div class="breadcrumb">
                        <span class="breadcrumb-item active">å·¥ä½œå°</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-btn">
                        <span>ğŸ””</span>
                        <span class="notification-badge">2</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar">å¼ </div>
                        <span id="userName">å¼ ä¸‰</span>
                    </div>
                </div>
            </header>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content-wrapper">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">ä»Šæ—¥å…¥åº“</div>
                            <div class="stat-icon">ğŸ“¥</div>
                        </div>
                        <div class="stat-value">2</div>
                        <div class="stat-footer">é‡‘é¢ï¼šÂ¥11,200</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">ä»Šæ—¥å‡ºåº“</div>
                            <div class="stat-icon">ğŸ“¤</div>
                        </div>
                        <div class="stat-value">1</div>
                        <div class="stat-footer">é‡‘é¢ï¼šÂ¥280</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">å¾…å®¡æ‰¹</div>
                            <div class="stat-icon" style="color: #faad14;">â³</div>
                        </div>
                        <div class="stat-value">1</div>
                        <div class="stat-footer">éœ€è¦å¤„ç†</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">åº“å­˜é¢„è­¦</div>
                            <div class="stat-icon" style="color: #f5222d;">âš ï¸</div>
                        </div>
                        <div class="stat-value">2</div>
                        <div class="stat-footer">ä½åº“å­˜/ç¼ºè´§</div>
                    </div>
                </div>

                <!-- å¿«æ·æ“ä½œ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">å¿«æ·æ“ä½œ</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div onclick="location.href='inbound-create.html'" style="cursor: pointer; text-align: center; padding: 24px; background: #f0f5ff; border-radius: 8px; transition: all 0.3s;">
                            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“¥</div>
                            <div style="font-size: 16px; font-weight: 500;">æ–°å»ºå…¥åº“</div>
                        </div>
                        <div onclick="location.href='outbound-create.html'" style="cursor: pointer; text-align: center; padding: 24px; background: #fff7e6; border-radius: 8px; transition: all 0.3s;">
                            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“¤</div>
                            <div style="font-size: 16px; font-weight: 500;">ç›´æ¥å‡ºåº“</div>
                        </div>
                        <div onclick="location.href='approval-list.html'" style="cursor: pointer; text-align: center; padding: 24px; background: #f6ffed; border-radius: 8px; transition: all 0.3s;">
                            <div style="font-size: 48px; margin-bottom: 12px;">âœ“</div>
                            <div style="font-size: 16px; font-weight: 500;">å®¡æ‰¹ç”³è¯·</div>
                        </div>
                        <div onclick="location.href='inventory-list.html'" style="cursor: pointer; text-align: center; padding: 24px; background: #fff0f6; border-radius: 8px; transition: all 0.3s;">
                            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“Š</div>
                            <div style="font-size: 16px; font-weight: 500;">æŸ¥çœ‹åº“å­˜</div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
                    <!-- å¾…åŠäº‹é¡¹ -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">å¾…åŠäº‹é¡¹</div>
                            <a href="approval-list.html" class="link">æŸ¥çœ‹å…¨éƒ¨</a>
                        </div>
                        <div id="todoList"></div>
                    </div>

                    <!-- åº“å­˜é¢„è­¦ -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">åº“å­˜é¢„è­¦</div>
                            <a href="inventory-list.html" class="link">æŸ¥çœ‹å…¨éƒ¨</a>
                        </div>
                        <div id="stockAlertList"></div>
                    </div>
                </div>

                <!-- æœ€è¿‘æ“ä½œ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">æœ€è¿‘æ“ä½œè®°å½•</div>
                        <a href="#" class="link">æŸ¥çœ‹æ›´å¤š</a>
                    </div>
                    <table id="recentTable">
                        <thead>
                            <tr>
                                <th>æ“ä½œæ—¶é—´</th>
                                <th>æ“ä½œç±»å‹</th>
                                <th>å•æ®ç¼–å·</th>
                                <th>æ“ä½œå†…å®¹</th>
                                <th>æ“ä½œäºº</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="../assets/js/mock-data.js"></script>
    <script src="../assets/js/common.js"></script>
    <script>
        // æ¸²æŸ“å¾…åŠäº‹é¡¹
        function renderTodoList() {
            const todoList = document.getElementById('todoList');

            // å¾…å®¡æ‰¹ç”³è¯·
            const pendingApplies = mockData.applyList.filter(a => a.status === 0);

            // å¾…é¢†å–å‡ºåº“å•
            const pendingOutbounds = mockData.outboundList.filter(o => o.status === 0);

            let html = '<div style="font-size: 14px;">';

            if (pendingApplies.length > 0) {
                html += `
                    <div style="padding: 12px; background: #fff7e6; border-radius: 4px; margin-bottom: 12px; cursor: pointer;" onclick="location.href='approval-list.html'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 500; margin-bottom: 4px;">â³ å¾…å®¡æ‰¹ç”³è¯·</div>
                                <div style="font-size: 13px; color: #8c8c8c;">æœ‰ ${pendingApplies.length} ä¸ªç”³è¯·å¾…å®¡æ‰¹</div>
                            </div>
                            <div style="font-size: 24px; color: #faad14;">${pendingApplies.length}</div>
                        </div>
                    </div>
                `;
            }

            if (pendingOutbounds.length > 0) {
                html += `
                    <div style="padding: 12px; background: #e6f7ff; border-radius: 4px; margin-bottom: 12px; cursor: pointer;" onclick="location.href='outbound-list.html?status=0'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 500; margin-bottom: 4px;">ğŸ“¦ å¾…é¢†å–å‡ºåº“å•</div>
                                <div style="font-size: 13px; color: #8c8c8c;">æœ‰ ${pendingOutbounds.length} ä¸ªå‡ºåº“å•å¾…é¢†å–</div>
                            </div>
                            <div style="font-size: 24px; color: #1890ff;">${pendingOutbounds.length}</div>
                        </div>
                    </div>
                `;
            }

            if (pendingApplies.length === 0 && pendingOutbounds.length === 0) {
                html += '<div class="empty-state" style="padding: 40px 0;"><div class="empty-icon">âœ“</div><div class="empty-text">æš‚æ— å¾…åŠäº‹é¡¹</div></div>';
            }

            html += '</div>';
            todoList.innerHTML = html;
        }

        // æ¸²æŸ“åº“å­˜é¢„è­¦
        function renderStockAlert() {
            const alertList = document.getElementById('stockAlertList');
            const alerts = mockData.inventoryList.filter(i => i.status === 2 || i.status === 3);

            let html = '<div style="font-size: 14px;">';

            alerts.slice(0, 5).forEach(item => {
                const icon = item.status === 3 ? 'â›”' : 'âš ï¸';
                const color = item.status === 3 ? '#f5222d' : '#faad14';
                html += `
                    <div style="padding: 12px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">${item.materialName}</div>
                            <div style="font-size: 13px; color: #8c8c8c;">${item.spec} | å½“å‰åº“å­˜ï¼š${item.quantity}${item.unit}</div>
                        </div>
                        <span class="tag" style="background: ${item.status === 3 ? '#fff1f0' : '#fffbe6'}; color: ${color}; border: 1px solid ${item.status === 3 ? '#ffccc7' : '#ffe58f'};">
                            ${icon} ${item.statusText}
                        </span>
                    </div>
                `;
            });

            if (alerts.length === 0) {
                html += '<div class="empty-state" style="padding: 40px 0;"><div class="empty-icon">âœ“</div><div class="empty-text">åº“å­˜æ­£å¸¸</div></div>';
            }

            html += '</div>';
            alertList.innerHTML = html;
        }

        // æ¸²æŸ“æœ€è¿‘æ“ä½œè®°å½•
        function renderRecentOperations() {
            const tbody = document.querySelector('#recentTable tbody');

            const operations = [
                { time: '2025-01-11 11:00:00', type: 'ç”³è¯·å®¡æ‰¹', code: 'SQ20250111001', content: 'é€šè¿‡ææ˜çš„ç‰©èµ„ç”³è¯·', operator: 'å¼ ä¸‰' },
                { time: '2025-01-11 10:30:00', type: 'ç›´æ¥å‡ºåº“', code: 'CK20250111001', content: 'å‡ºåº“å…‰çº¤æ”¶å‘å™¨ 1å°', operator: 'å¼ ä¸‰' },
                { time: '2025-01-11 09:30:00', type: 'æ–°å»ºå…¥åº“', code: 'RK20250111001', content: 'å…¥åº“äº¤æ¢æœºã€è·¯ç”±å™¨ç­‰è®¾å¤‡', operator: 'å¼ ä¸‰' },
                { time: '2025-01-10 15:20:00', type: 'ç¡®è®¤å‡ºåº“', code: 'CK20250110003', content: 'ç‹èŠ³é¢†å–åŠå…¬ç”¨å“', operator: 'å¼ ä¸‰' },
                { time: '2025-01-10 14:20:00', type: 'æ–°å»ºå…¥åº“', code: 'RK20250111002', content: 'å…¥åº“ç½‘çº¿ã€å…‰çº¤è·³çº¿', operator: 'å¼ ä¸‰' }
            ];

            let html = '';
            operations.forEach(op => {
                const typeColor = {
                    'æ–°å»ºå…¥åº“': 'text-primary',
                    'ç›´æ¥å‡ºåº“': 'text-warning',
                    'ç”³è¯·å®¡æ‰¹': 'text-success',
                    'ç¡®è®¤å‡ºåº“': 'text-success'
                }[op.type] || '';

                html += `
                    <tr>
                        <td>${formatDateTime(op.time)}</td>
                        <td><span class="${typeColor}">${op.type}</span></td>
                        <td>${op.code}</td>
                        <td>${op.content}</td>
                        <td>${op.operator}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
            const user = Session.getCurrentUser();
            document.getElementById('userName').textContent = user.name;

            // æ¸²æŸ“å„ä¸ªæ¨¡å—
            renderTodoList();
            renderStockAlert();
            renderRecentOperations();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
