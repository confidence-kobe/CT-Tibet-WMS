# MySQL 8.0 Production Configuration for CT-Tibet-WMS
# Optimized for performance, stability, and security

[mysqld]

# ============================================================================
# GENERAL SETTINGS
# ============================================================================
# MySQL Server Port
port = 3306
# Bind to all interfaces
bind-address = 0.0.0.0
# Skip DNS resolution for faster connections
skip-host-cache
skip-name-resolve
# Default character set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ============================================================================
# CONNECTION SETTINGS
# ============================================================================
# Maximum allowed connections
max_connections = 1000
# Maximum connection errors before blocking host
max_connect_errors = 100
# Connection timeout (seconds)
connect_timeout = 10
# Interactive timeout
interactive_timeout = 28800
# Wait timeout
wait_timeout = 28800

# ============================================================================
# MEMORY SETTINGS
# ============================================================================
# InnoDB buffer pool size (adjust based on available RAM)
innodb_buffer_pool_size = 1G
# InnoDB log file size
innodb_log_file_size = 256M
# InnoDB flush method
innodb_flush_method = O_DIRECT
# InnoDB flush log at transaction commit
innodb_flush_log_at_trx_commit = 2

# ============================================================================
# QUERY EXECUTION SETTINGS
# ============================================================================
# Default storage engine
default_storage_engine = InnoDB
# Maximum allowed packet size
max_allowed_packet = 256M
# SQL mode for stricter SQL compliance
sql_mode = 'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'

# ============================================================================
# LOGGING SETTINGS
# ============================================================================
# Error log
log_error = /var/log/mysql/error.log
# Slow query log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 0

# ============================================================================
# BINARY LOGGING (for replication and backup)
# ============================================================================
server-id = 1
log_bin = /var/log/mysql/mysql-bin
binlog_format = ROW
binlog_expire_logs_seconds = 604800  # 7 days
binlog_cache_size = 32K
binlog_row_image = MINIMAL

# ============================================================================
# REPLICATION SETTINGS (if needed)
# ============================================================================
# relay-log = /var/log/mysql/mysql-relay-bin
# relay-log-index = /var/log/mysql/mysql-relay-bin.index

# ============================================================================
# PERFORMANCE SCHEMA
# ============================================================================
# Enable performance schema for monitoring
performance_schema = ON
# Adjust performance schema max tables
performance_schema_max_table_instances = 12500

# ============================================================================
# INNODB SETTINGS FOR STABILITY
# ============================================================================
# Autoextend increment
innodb_autoextend_increment = 64
# Status file
innodb_status_file = ON
# Table locks
innodb_table_locks = ON
# Lock wait timeout
innodb_lock_wait_timeout = 50

# ============================================================================
# THREAD SETTINGS
# ============================================================================
# Thread stack size
thread_stack = 192K
# Thread cache size
thread_cache_size = 50

# ============================================================================
# QUERY CACHE SETTINGS (Disabled in MySQL 8.0+)
# ============================================================================
# Query cache is deprecated in MySQL 8.0, remove if using 8.0+
# query_cache_type = 0
# query_cache_size = 0

# ============================================================================
# TRANSACTION SETTINGS
# ============================================================================
# Default transaction isolation level
transaction_isolation = READ-COMMITTED
# Transaction timeout
default_transaction_timeout = 300

# ============================================================================
# SECURITY SETTINGS
# ============================================================================
# Require secure transport (uncomment for production with SSL)
# require_secure_transport = ON
# Validate passwords
# validate_password.policy = STRONG

# ============================================================================
# CLIENT CONNECTION SETTINGS
# ============================================================================
[mysqldump]
# Dump buffer size
max_allowed_packet = 256M
# Use single transaction for consistency
single-transaction
# Quick mode
quick

[mysql]
# Default charset
default-character-set = utf8mb4

[client]
# Default charset
default-character-set = utf8mb4
# Port
port = 3306
