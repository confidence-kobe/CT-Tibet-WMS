# RabbitMQ Production Configuration for CT-Tibet-WMS
# Reference: https://www.rabbitmq.com/configure.html

# ============================================================================
# NETWORK AND PROTOCOL SETTINGS
# ============================================================================
# TCP listener port
listeners.tcp.default = 5672
# TCP listener backlog
tcp_backlog = 4096
# Enable management plugin (for UI)
management.listener.port = 15672

# ============================================================================
# VIRTUAL HOST SETTINGS
# ============================================================================
# Virtual host path (vhost) management
management.load_definitions = /etc/rabbitmq/definitions.json

# ============================================================================
# MEMORY MANAGEMENT
# ============================================================================
# Enable memory monitoring
total_memory_available_override_value = 512MB
# Memory watermark setting (high water mark)
vm_memory_high_watermark.relative = 0.6
# Memory paging trigger
vm_memory_high_watermark_paging_ratio = 0.75

# ============================================================================
# DISK SPACE MONITORING
# ============================================================================
# Free disk limit (stop accepting connections if disk space below this)
disk_free_limit.absolute = 50MB
# Free disk limit percentage
disk_free_limit.relative = 0.05

# ============================================================================
# QUEUE SETTINGS
# ============================================================================
# Channel max
channel_max = 2048
# Heartbeat (seconds) - keep-alive mechanism
heartbeat = 60
# Frame max size
frame_max = 131072

# ============================================================================
# CLUSTERING
# ============================================================================
# Single node setup (no clustering)
cluster_partition_handling = autoheal

# ============================================================================
# MESSAGE PERSISTENCE
# ============================================================================
# Queue index embed limit (messages smaller than this are stored in index)
queue_index_embed_limit_bytes = 4096

# ============================================================================
# LOG SETTINGS
# ============================================================================
# Log file location
log.file.level = info
# Console logging
log.console = true
log.console.level = info
# Log rotation
log.file.rotation.count = 5
log.file.rotation.size = 50MB

# ============================================================================
# MANAGEMENT PLUGIN SETTINGS
# ============================================================================
management.tcp.port = 15672
management.ssl.port = 15671
# Load definitions from file (for users and vhosts)
management.load_definitions = /etc/rabbitmq/definitions.json

# ============================================================================
# AUTHENTICATION AND AUTHORIZATION
# ============================================================================
# Auth backend
auth_backends.1 = internal
# Auth mechanisms
auth_mechanisms.1 = PLAIN
auth_mechanisms.2 = AMQPLAIN

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================
# Channels handshake timeout
amqp_heartbeat = 60
# TCP buffer sizes
tcp_recv_buf = 131072
tcp_send_buf = 131072

# ============================================================================
# SECURITY SETTINGS
# ============================================================================
# Require credential for connection (no anonymous access)
# auth_backends.1 = internal
# Disable management UI anonymous access
management.load_definitions = /etc/rabbitmq/definitions.json

# ============================================================================
# ADVANCED SETTINGS
# ============================================================================
# Message TTL (time-to-live) default in milliseconds
# Adjust as needed for your use case
# message_ttl = 3600000

# Consumer prefetch count (number of messages fetched at once)
# This is per-channel consumer, adjust for your workload
consumer_max_prefetch = 10

# ============================================================================
# PLUGINS
# ============================================================================
# Enabled plugins
management.load_definitions = /etc/rabbitmq/definitions.json
