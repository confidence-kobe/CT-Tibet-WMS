# 仓库管理系统数据库设计文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 系统名称 | 西藏电信仓库管理系统 (CT-Tibet-WMS) |
| 数据库版本 | v1.0 |
| 数据库类型 | MySQL 8.0+ |
| 字符集 | utf8mb4 |
| 排序规则 | utf8mb4_unicode_ci |
| 文档状态 | 待评审 |
| 创建日期 | 2025-11-11 |
| 作者 | 技术团队 |

---

## 目录

1. [数据库概述](#1-数据库概述)
2. [数据库设计原则](#2-数据库设计原则)
3. [数据库ER图](#3-数据库er图)
4. [表结构设计](#4-表结构设计)
5. [索引设计](#5-索引设计)
6. [视图设计](#6-视图设计)
7. [存储过程设计](#7-存储过程设计)
8. [触发器设计](#8-触发器设计)
9. [数据字典](#9-数据字典)
10. [备份与恢复策略](#10-备份与恢复策略)
11. [性能优化建议](#11-性能优化建议)
12. [附录](#12-附录)

---

## 1. 数据库概述

### 1.1 数据库基本信息

```sql
数据库名称: ct_tibet_wms
字符集: utf8mb4
排序规则: utf8mb4_unicode_ci
存储引擎: InnoDB
时区: Asia/Shanghai
```

### 1.2 表分类统计

| 分类 | 表数量 | 说明 |
|------|--------|------|
| 系统管理 | 4 | 用户、角色、部门、权限 |
| 基础数据 | 2 | 物资、仓库 |
| 业务数据 | 8 | 入库、出库、申请、库存 |
| 消息通知 | 1 | 站内消息 |
| 系统日志 | 2 | 操作日志、登录日志 |
| **合计** | **17** | |

### 1.3 数据量预估

| 表名 | 预估年增量 | 3年总量 | 备注 |
|------|-----------|---------|------|
| tb_user | 50条 | 500条 | 用户增长缓慢 |
| tb_inbound | 5000条 | 15000条 | 每天约14条 |
| tb_inbound_detail | 15000条 | 45000条 | 每条入库单平均3个明细 |
| tb_outbound | 8000条 | 24000条 | 每天约22条 |
| tb_outbound_detail | 24000条 | 72000条 | 每条出库单平均3个明细 |
| tb_apply | 6000条 | 18000条 | 每天约16条申请 |
| tb_apply_detail | 18000条 | 54000条 | 每条申请平均3个明细 |
| tb_inventory | 200条 | 500条 | 物资品种增长缓慢 |
| tb_message | 20000条 | 60000条 | 定期清理历史消息 |
| tb_operation_log | 50000条 | 150000条 | 定期归档 |

---

## 2. 数据库设计原则

### 2.1 命名规范

**表命名规范**：
- 使用前缀 `tb_` 表示业务表
- 使用小写字母，单词间用下划线分隔
- 表名使用单数形式
- 示例：`tb_user`, `tb_material`, `tb_inbound`

**字段命名规范**：
- 使用小写字母，单词间用下划线分隔
- 主键统一使用 `id`
- 外键使用 `关联表名_id`（如 `dept_id`, `material_id`）
- 时间字段统一使用 `_time` 后缀（如 `create_time`, `update_time`）
- 状态字段使用 `status`
- 布尔类型使用 `is_` 前缀（如 `is_read`, `is_deleted`）

**索引命名规范**：
- 普通索引：`idx_字段名` 或 `idx_字段1_字段2`
- 唯一索引：`uk_字段名`
- 外键索引：`fk_表名_关联表名`

### 2.2 设计原则

1. **三范式原则**：遵循数据库三范式，减少数据冗余
2. **适度冗余**：为提高查询性能，适当保留冗余字段（如领用人姓名）
3. **软删除**：重要数据使用软删除（`is_deleted`），而非物理删除
4. **审计字段**：所有业务表包含 `create_time`, `update_time`
5. **字段非空**：尽量使用 `NOT NULL` + `DEFAULT`，避免 NULL 值
6. **字符集统一**：全库使用 `utf8mb4` 支持特殊字符和emoji
7. **主键设计**：使用自增 `BIGINT` 作为主键
8. **外键约束**：不使用数据库外键约束，在应用层维护关联关系

### 2.3 字段类型选择

| 数据类型 | 使用场景 | 示例 |
|---------|---------|------|
| BIGINT | 主键、外键 | id, user_id |
| VARCHAR(n) | 变长字符串 | username, material_name |
| CHAR(n) | 定长字符串 | dept_code(5) |
| TEXT | 长文本 | purpose, remark |
| DECIMAL(10,2) | 金额、数量 | price, quantity |
| TINYINT | 小整数、状态 | status, type |
| DATETIME | 日期时间 | create_time |
| TIMESTAMP | 自动更新时间 | update_time |

---

## 3. 数据库ER图

### 3.1 整体ER关系图

```
┌──────────────┐
│   tb_user    │ 1
│  (用户表)     │───┐
└──────────────┘   │
       │           │ N
       │ N         │
       │           ▼
       │      ┌──────────────┐
       │      │  tb_apply    │
       │      │  (申请单表)   │
       │      └──────────────┘
       │           │ 1
       │           │
       │           │ N
       │           ▼
       │      ┌──────────────┐
       │      │tb_apply_detail│
       │      │ (申请明细表)  │
       │      └──────────────┘
       │
       │ N
       ▼
┌──────────────┐        1 ┌──────────────┐
│  tb_dept     │◄──────────┤ tb_warehouse │
│  (部门表)     │           │  (仓库表)     │
└──────────────┘           └──────────────┘
                                  │ 1
                                  │
                                  │ N
                                  ▼
                           ┌──────────────┐
                           │ tb_inventory │
                           │  (库存表)     │
                           └──────────────┘
                                  │
                           ┌──────┴──────┐
                           │             │
                         1 │             │ 1
                           ▼             ▼
                    ┌──────────┐  ┌──────────┐
                    │tb_inbound│  │tb_outbound│
                    │(入库单表)│  │(出库单表) │
                    └──────────┘  └──────────┘
                         │             │
                       N │             │ N
                         ▼             ▼
                 ┌─────────────┐ ┌─────────────┐
                 │tb_inbound   │ │tb_outbound  │
                 │  _detail    │ │  _detail    │
                 │(入库明细表) │ │(出库明细表) │
                 └─────────────┘ └─────────────┘
                         │             │
                         └──────┬──────┘
                                │ N
                                │
                              1 ▼
                        ┌──────────────┐
                        │ tb_material  │
                        │  (物资表)     │
                        └──────────────┘

┌──────────────┐
│   tb_role    │
│  (角色表)     │
└──────────────┘
       │ 1
       │
       │ N
       ▼
┌──────────────┐        N ┌──────────────┐
│tb_role_menu  │◄──────────┤  tb_menu     │
│(角色菜单关联) │           │  (菜单表)     │
└──────────────┘           └──────────────┘

┌──────────────┐
│ tb_message   │
│  (消息表)     │
└──────────────┘

┌──────────────┐
│tb_operation  │
│   _log       │
│ (操作日志表)  │
└──────────────┘

┌──────────────┐
│ tb_login_log │
│ (登录日志表)  │
└──────────────┘
```

### 3.2 核心业务流程ER图

**申请审批出库流程**：

```
tb_user(员工) → tb_apply(申请单) → tb_apply_detail(申请明细)
                     ↓ (审批)
tb_user(仓管) → tb_apply(审批信息)
                     ↓ (通过后自动创建)
              tb_outbound(出库单-待领取)
                     ↓ (确认领取)
              tb_outbound(出库单-已出库)
                     ↓ (扣减库存)
              tb_inventory(库存更新)
```

---

## 4. 表结构设计

### 4.1 系统管理模块

#### 4.1.1 用户表 (tb_user)

**表说明**：存储系统用户基本信息

```sql
CREATE TABLE `tb_user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` VARCHAR(50) NOT NULL COMMENT '登录名',
  `password` VARCHAR(100) NOT NULL COMMENT '密码(BCrypt加密)',
  `real_name` VARCHAR(50) NOT NULL COMMENT '真实姓名',
  `phone` VARCHAR(20) NOT NULL COMMENT '手机号',
  `email` VARCHAR(100) DEFAULT NULL COMMENT '邮箱',
  `dept_id` BIGINT NOT NULL COMMENT '所属部门ID',
  `role_id` BIGINT NOT NULL COMMENT '角色ID',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0启用 1禁用',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `wechat_openid` VARCHAR(100) DEFAULT NULL COMMENT '微信openid',
  `wechat_nickname` VARCHAR(50) DEFAULT NULL COMMENT '微信昵称',
  `last_login_time` DATETIME DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP',
  `password_update_time` DATETIME DEFAULT NULL COMMENT '密码最后修改时间',
  `is_first_login` TINYINT NOT NULL DEFAULT 1 COMMENT '是否首次登录:0否 1是',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT '是否删除:0否 1是',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_phone` (`phone`),
  UNIQUE KEY `uk_wechat_openid` (`wechat_openid`),
  KEY `idx_dept_id` (`dept_id`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

**字段说明**：

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| id | BIGINT | Y | 主键，自增 |
| username | VARCHAR(50) | Y | 登录名，全局唯一 |
| password | VARCHAR(100) | Y | BCrypt加密密码 |
| real_name | VARCHAR(50) | Y | 真实姓名 |
| phone | VARCHAR(20) | Y | 手机号，全局唯一 |
| email | VARCHAR(100) | N | 邮箱 |
| dept_id | BIGINT | Y | 所属部门ID |
| role_id | BIGINT | Y | 角色ID |
| status | TINYINT | Y | 0=启用，1=禁用 |
| wechat_openid | VARCHAR(100) | N | 微信小程序openid |
| is_first_login | TINYINT | Y | 首次登录需强制修改密码 |
| is_deleted | TINYINT | Y | 软删除标记 |

**业务规则**：
- 登录名和手机号全局唯一
- 默认密码：123456（首次登录强制修改）
- 禁用用户不能登录但数据保留
- 删除用户使用软删除（is_deleted=1）

#### 4.1.2 角色表 (tb_role)

**表说明**：存储系统角色信息

```sql
CREATE TABLE `tb_role` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '角色ID',
  `role_name` VARCHAR(50) NOT NULL COMMENT '角色名称',
  `role_code` VARCHAR(50) NOT NULL COMMENT '角色编码',
  `role_level` TINYINT NOT NULL DEFAULT 0 COMMENT '角色级别:0系统管理员 1部门管理员 2仓库管理员 3普通员工',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '角色描述',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0启用 1禁用',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT '是否删除:0否 1是',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_code` (`role_code`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色表';
```

**初始数据**：

```sql
INSERT INTO tb_role (role_name, role_code, role_level, description) VALUES
('系统管理员', 'admin', 0, '系统最高权限，管理所有功能'),
('部门管理员', 'dept_admin', 1, '管理本部门用户、仓库、出入库、审批'),
('仓库管理员', 'warehouse', 2, '管理本部门出入库、审批员工申请'),
('普通员工', 'user', 3, '申请出库、查看库存');
```

#### 4.1.3 部门表 (tb_dept)

**表说明**：存储组织架构部门信息

```sql
CREATE TABLE `tb_dept` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '部门ID',
  `dept_name` VARCHAR(50) NOT NULL COMMENT '部门名称',
  `dept_code` VARCHAR(10) NOT NULL COMMENT '部门编码(用于单号生成)',
  `parent_id` BIGINT DEFAULT 0 COMMENT '上级部门ID(0表示根部门)',
  `ancestors` VARCHAR(200) DEFAULT '' COMMENT '祖级列表(1,2,3)',
  `leader_id` BIGINT DEFAULT NULL COMMENT '部门负责人ID',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT '联系电话',
  `email` VARCHAR(100) DEFAULT NULL COMMENT '邮箱',
  `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0启用 1禁用',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT '是否删除:0否 1是',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_dept_code` (`dept_code`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='部门表';
```

**初始数据**：

```sql
INSERT INTO tb_dept (dept_name, dept_code, parent_id, sort) VALUES
('西藏电信', 'ROOT', 0, 0),
('网络运维部', 'WL', 1, 1),
('市场营销部', 'SC', 1, 2),
('客户服务部', 'KF', 1, 3),
('财务部', 'CW', 1, 4),
('人力资源部', 'RZ', 1, 5),
('技术支持部', 'JS', 1, 6),
('综合管理部', 'ZH', 1, 7);
```

#### 4.1.4 菜单表 (tb_menu)

**表说明**：存储系统菜单和权限资源

```sql
CREATE TABLE `tb_menu` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '菜单ID',
  `menu_name` VARCHAR(50) NOT NULL COMMENT '菜单名称',
  `menu_code` VARCHAR(50) NOT NULL COMMENT '菜单编码',
  `parent_id` BIGINT DEFAULT 0 COMMENT '父菜单ID(0表示根菜单)',
  `menu_type` TINYINT NOT NULL DEFAULT 1 COMMENT '菜单类型:1目录 2菜单 3按钮',
  `path` VARCHAR(200) DEFAULT NULL COMMENT '路由地址',
  `component` VARCHAR(200) DEFAULT NULL COMMENT '组件路径',
  `permission` VARCHAR(100) DEFAULT NULL COMMENT '权限标识(如:user:add)',
  `icon` VARCHAR(50) DEFAULT NULL COMMENT '菜单图标',
  `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
  `visible` TINYINT NOT NULL DEFAULT 1 COMMENT '是否可见:0隐藏 1显示',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0启用 1禁用',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_menu_code` (`menu_code`),
  KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='菜单表';
```

#### 4.1.5 角色菜单关联表 (tb_role_menu)

**表说明**：存储角色与菜单的多对多关系

```sql
CREATE TABLE `tb_role_menu` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `role_id` BIGINT NOT NULL COMMENT '角色ID',
  `menu_id` BIGINT NOT NULL COMMENT '菜单ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_menu` (`role_id`, `menu_id`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_menu_id` (`menu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色菜单关联表';
```

### 4.2 基础数据模块

#### 4.2.1 物资表 (tb_material)

**表说明**：存储仓库物资品类信息

```sql
CREATE TABLE `tb_material` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '物资ID',
  `material_name` VARCHAR(100) NOT NULL COMMENT '物资名称',
  `material_code` VARCHAR(50) NOT NULL COMMENT '物资编码(全局唯一)',
  `category` VARCHAR(50) NOT NULL COMMENT '物资类别(光缆类/设备类/配件类/工具类)',
  `spec` VARCHAR(100) DEFAULT NULL COMMENT '规格型号',
  `unit` VARCHAR(20) NOT NULL COMMENT '单位(条/台/米/个)',
  `price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '单价(元)',
  `min_stock` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '最低库存预警阈值',
  `description` TEXT DEFAULT NULL COMMENT '物资描述',
  `image` VARCHAR(255) DEFAULT NULL COMMENT '物资图片URL',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0启用 1停用',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT '是否删除:0否 1是',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_material_code` (`material_code`),
  KEY `idx_category` (`category`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='物资表';
```

**字段说明**：

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| material_code | VARCHAR(50) | Y | 物资编码，全局唯一 |
| category | VARCHAR(50) | Y | 光缆类/设备类/配件类/工具类 |
| unit | VARCHAR(20) | Y | 条/台/米/个/箱 |
| min_stock | DECIMAL(10,2) | Y | 低于此值触发预警 |
| status | TINYINT | Y | 停用物资不能用于新的出入库 |

**物资类别枚举**：
- 光缆类：光缆12芯、光缆24芯、光缆48芯
- 设备类：交换机、路由器、OLT设备、ONU设备
- 配件类：网线、光纤跳线、配线架、机柜
- 工具类：光纤熔接机、OTDR测试仪、网线钳

#### 4.2.2 仓库表 (tb_warehouse)

**表说明**：存储各部门仓库信息

```sql
CREATE TABLE `tb_warehouse` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '仓库ID',
  `warehouse_name` VARCHAR(100) NOT NULL COMMENT '仓库名称',
  `warehouse_code` VARCHAR(50) NOT NULL COMMENT '仓库编码',
  `dept_id` BIGINT NOT NULL COMMENT '所属部门ID',
  `address` VARCHAR(200) DEFAULT NULL COMMENT '仓库地址',
  `manager_id` BIGINT DEFAULT NULL COMMENT '仓库管理员ID',
  `capacity` DECIMAL(10,2) DEFAULT NULL COMMENT '仓库容量(平方米)',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0启用 1禁用',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT '是否删除:0否 1是',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_warehouse_code` (`warehouse_code`),
  KEY `idx_dept_id` (`dept_id`),
  KEY `idx_manager_id` (`manager_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='仓库表';
```

### 4.3 业务数据模块

#### 4.3.1 入库单表 (tb_inbound)

**表说明**：存储物资入库主单信息

```sql
CREATE TABLE `tb_inbound` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '入库单ID',
  `inbound_no` VARCHAR(50) NOT NULL COMMENT '入库单号(RK_部门编码_YYYYMMDD_流水号)',
  `warehouse_id` BIGINT NOT NULL COMMENT '入库仓库ID',
  `inbound_type` TINYINT NOT NULL DEFAULT 1 COMMENT '入库类型:1采购入库 2退货入库 3调拨入库 4其他',
  `operator_id` BIGINT NOT NULL COMMENT '操作人ID(仓管员)',
  `operator_name` VARCHAR(50) NOT NULL COMMENT '操作人姓名(冗余)',
  `inbound_time` DATETIME NOT NULL COMMENT '入库时间',
  `total_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '入库总金额',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态:1已入库',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_inbound_no` (`inbound_no`),
  KEY `idx_warehouse_id` (`warehouse_id`),
  KEY `idx_operator_id` (`operator_id`),
  KEY `idx_inbound_time` (`inbound_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='入库单表';
```

**单号生成规则**：
```
格式：RK_部门编码_YYYYMMDD_流水号
示例：RK_WL_20251110_0001
说明：
- RK = 入库(RuKu)
- WL = 网络运维部
- 20251110 = 2025年11月10日
- 0001 = 当天流水号(4位，从0001开始)
```

#### 4.3.2 入库明细表 (tb_inbound_detail)

**表说明**：存储入库单物资明细

```sql
CREATE TABLE `tb_inbound_detail` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '明细ID',
  `inbound_id` BIGINT NOT NULL COMMENT '入库单ID',
  `material_id` BIGINT NOT NULL COMMENT '物资ID',
  `material_name` VARCHAR(100) NOT NULL COMMENT '物资名称(冗余)',
  `material_code` VARCHAR(50) NOT NULL COMMENT '物资编码(冗余)',
  `spec` VARCHAR(100) DEFAULT NULL COMMENT '规格型号(冗余)',
  `unit` VARCHAR(20) NOT NULL COMMENT '单位(冗余)',
  `quantity` DECIMAL(10,2) NOT NULL COMMENT '入库数量',
  `unit_price` DECIMAL(10,2) DEFAULT 0.00 COMMENT '单价',
  `amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '金额(quantity * unit_price)',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_inbound_id` (`inbound_id`),
  KEY `idx_material_id` (`material_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='入库明细表';
```

**业务规则**：
- 入库数量必须 > 0
- 入库后立即更新库存（inventory.quantity += detail.quantity）
- 明细中冗余物资基本信息，防止物资信息变更影响历史记录

#### 4.3.3 出库单表 (tb_outbound)

**表说明**：存储物资出库主单信息

```sql
CREATE TABLE `tb_outbound` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '出库单ID',
  `outbound_no` VARCHAR(50) NOT NULL COMMENT '出库单号(CK_部门编码_YYYYMMDD_流水号)',
  `warehouse_id` BIGINT NOT NULL COMMENT '出库仓库ID',
  `outbound_type` TINYINT NOT NULL DEFAULT 1 COMMENT '出库类型:1领用出库 2报废出库 3调拨出库 4其他',
  `source` TINYINT NOT NULL DEFAULT 1 COMMENT '出库来源:1直接创建 2申请自动创建',
  `apply_id` BIGINT DEFAULT NULL COMMENT '关联申请单ID(来源为2时)',
  `receiver_id` BIGINT DEFAULT NULL COMMENT '领用人ID',
  `receiver_name` VARCHAR(50) NOT NULL COMMENT '领用人姓名',
  `receiver_phone` VARCHAR(20) DEFAULT NULL COMMENT '领用人手机号(冗余)',
  `purpose` VARCHAR(500) DEFAULT NULL COMMENT '领用用途',
  `operator_id` BIGINT NOT NULL COMMENT '操作人ID(仓管员)',
  `operator_name` VARCHAR(50) NOT NULL COMMENT '操作人姓名(冗余)',
  `outbound_time` DATETIME DEFAULT NULL COMMENT '实际出库时间(确认领取时间)',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0待领取 1已出库 2已取消',
  `cancel_reason` VARCHAR(500) DEFAULT NULL COMMENT '取消原因',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_by` BIGINT DEFAULT NULL COMMENT '创建人ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_by` BIGINT DEFAULT NULL COMMENT '更新人ID',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_outbound_no` (`outbound_no`),
  KEY `idx_warehouse_id` (`warehouse_id`),
  KEY `idx_apply_id` (`apply_id`),
  KEY `idx_receiver_id` (`receiver_id`),
  KEY `idx_operator_id` (`operator_id`),
  KEY `idx_status` (`status`),
  KEY `idx_outbound_time` (`outbound_time`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='出库单表';
```

**单号生成规则**：
```
格式：CK_部门编码_YYYYMMDD_流水号
示例：CK_WL_20251110_0001
```

**状态流转**：
```
直接创建：创建 → 已出库(status=1，立即扣库存)
申请创建：创建 → 待领取(status=0) → 确认领取 → 已出库(status=1，扣库存)
超时处理：待领取(status=0) → 已取消(status=2，7天未领取)
```

#### 4.3.4 出库明细表 (tb_outbound_detail)

**表说明**：存储出库单物资明细

```sql
CREATE TABLE `tb_outbound_detail` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '明细ID',
  `outbound_id` BIGINT NOT NULL COMMENT '出库单ID',
  `material_id` BIGINT NOT NULL COMMENT '物资ID',
  `material_name` VARCHAR(100) NOT NULL COMMENT '物资名称(冗余)',
  `material_code` VARCHAR(50) NOT NULL COMMENT '物资编码(冗余)',
  `spec` VARCHAR(100) DEFAULT NULL COMMENT '规格型号(冗余)',
  `unit` VARCHAR(20) NOT NULL COMMENT '单位(冗余)',
  `quantity` DECIMAL(10,2) NOT NULL COMMENT '出库数量',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_outbound_id` (`outbound_id`),
  KEY `idx_material_id` (`material_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='出库明细表';
```

#### 4.3.5 申请单表 (tb_apply)

**表说明**：存储员工物资领用申请信息

```sql
CREATE TABLE `tb_apply` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '申请单ID',
  `apply_no` VARCHAR(50) NOT NULL COMMENT '申请单号(SQ_部门编码_YYYYMMDD_流水号)',
  `applicant_id` BIGINT NOT NULL COMMENT '申请人ID',
  `applicant_name` VARCHAR(50) NOT NULL COMMENT '申请人姓名(冗余)',
  `applicant_phone` VARCHAR(20) DEFAULT NULL COMMENT '申请人手机号(冗余)',
  `dept_id` BIGINT NOT NULL COMMENT '申请人部门ID',
  `dept_name` VARCHAR(50) NOT NULL COMMENT '申请人部门名称(冗余)',
  `purpose` TEXT NOT NULL COMMENT '领用用途(必填)',
  `apply_time` DATETIME NOT NULL COMMENT '申请时间',
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT '状态:0待审批 1已通过 2已拒绝 3已出库 4已取消',
  `approver_id` BIGINT DEFAULT NULL COMMENT '审批人ID',
  `approver_name` VARCHAR(50) DEFAULT NULL COMMENT '审批人姓名(冗余)',
  `approval_time` DATETIME DEFAULT NULL COMMENT '审批时间',
  `approval_opinion` VARCHAR(500) DEFAULT NULL COMMENT '审批意见',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `outbound_id` BIGINT DEFAULT NULL COMMENT '关联出库单ID(审批通过后)',
  `cancel_reason` VARCHAR(500) DEFAULT NULL COMMENT '取消原因',
  `cancel_time` DATETIME DEFAULT NULL COMMENT '取消时间',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_apply_no` (`apply_no`),
  KEY `idx_applicant_id` (`applicant_id`),
  KEY `idx_dept_id` (`dept_id`),
  KEY `idx_status` (`status`),
  KEY `idx_apply_time` (`apply_time`),
  KEY `idx_approver_id` (`approver_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='申请单表';
```

**单号生成规则**：
```
格式：SQ_部门编码_YYYYMMDD_流水号
示例：SQ_WL_20251110_0001
说明：SQ = 申请(ShenQing)
```

**状态流转**：
```
待审批(0) → 已通过(1) → 已出库(3)
待审批(0) → 已拒绝(2)
待审批(0) → 已取消(4，员工撤销）
已通过(1) → 已取消(4，超时未领取)
```

#### 4.3.6 申请明细表 (tb_apply_detail)

**表说明**：存储申请单物资明细

```sql
CREATE TABLE `tb_apply_detail` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '明细ID',
  `apply_id` BIGINT NOT NULL COMMENT '申请单ID',
  `material_id` BIGINT NOT NULL COMMENT '物资ID',
  `material_name` VARCHAR(100) NOT NULL COMMENT '物资名称(冗余)',
  `material_code` VARCHAR(50) NOT NULL COMMENT '物资编码(冗余)',
  `spec` VARCHAR(100) DEFAULT NULL COMMENT '规格型号(冗余)',
  `unit` VARCHAR(20) NOT NULL COMMENT '单位(冗余)',
  `quantity` DECIMAL(10,2) NOT NULL COMMENT '申请数量',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_apply_id` (`apply_id`),
  KEY `idx_material_id` (`material_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='申请明细表';
```

#### 4.3.7 库存表 (tb_inventory)

**表说明**：存储各仓库物资实时库存

```sql
CREATE TABLE `tb_inventory` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '库存ID',
  `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID',
  `material_id` BIGINT NOT NULL COMMENT '物资ID',
  `quantity` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '当前库存数量',
  `locked_quantity` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '锁定数量(待领取的申请)',
  `available_quantity` DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '可用数量(quantity-locked_quantity)',
  `last_inbound_time` DATETIME DEFAULT NULL COMMENT '最后入库时间',
  `last_outbound_time` DATETIME DEFAULT NULL COMMENT '最后出库时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_warehouse_material` (`warehouse_id`, `material_id`),
  KEY `idx_material_id` (`material_id`),
  KEY `idx_quantity` (`quantity`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='库存表';
```

**字段说明**：

| 字段名 | 说明 |
|-------|------|
| quantity | 实际库存数量 |
| locked_quantity | 已审批通过但未领取的数量（预留） |
| available_quantity | 可用数量 = quantity - locked_quantity |

**库存计算逻辑**：
```sql
-- 入库：quantity += 入库数量
UPDATE tb_inventory SET quantity = quantity + #{inboundQuantity} WHERE ...

-- 直接出库：quantity -= 出库数量（立即扣减）
UPDATE tb_inventory SET quantity = quantity - #{outboundQuantity} WHERE ...

-- 申请审批通过：locked_quantity += 申请数量（锁定库存）
UPDATE tb_inventory SET locked_quantity = locked_quantity + #{applyQuantity} WHERE ...

-- 确认领取：quantity -= 出库数量, locked_quantity -= 出库数量
UPDATE tb_inventory
SET quantity = quantity - #{outboundQuantity},
    locked_quantity = locked_quantity - #{outboundQuantity}
WHERE ...

-- 申请取消/超时：locked_quantity -= 申请数量（释放锁定）
UPDATE tb_inventory SET locked_quantity = locked_quantity - #{applyQuantity} WHERE ...
```

#### 4.3.8 库存流水表 (tb_inventory_log)

**表说明**：记录库存变动明细，用于追溯和审计

```sql
CREATE TABLE `tb_inventory_log` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '流水ID',
  `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID',
  `material_id` BIGINT NOT NULL COMMENT '物资ID',
  `material_name` VARCHAR(100) NOT NULL COMMENT '物资名称(冗余)',
  `change_type` TINYINT NOT NULL COMMENT '变动类型:1入库 2出库',
  `change_quantity` DECIMAL(10,2) NOT NULL COMMENT '变动数量(正数为增加,负数为减少)',
  `before_quantity` DECIMAL(10,2) NOT NULL COMMENT '变动前数量',
  `after_quantity` DECIMAL(10,2) NOT NULL COMMENT '变动后数量',
  `related_no` VARCHAR(50) NOT NULL COMMENT '关联单号(入库单号/出库单号)',
  `related_type` TINYINT NOT NULL COMMENT '关联类型:1入库单 2出库单',
  `operator_id` BIGINT NOT NULL COMMENT '操作人ID',
  `operator_name` VARCHAR(50) NOT NULL COMMENT '操作人姓名(冗余)',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_warehouse_material` (`warehouse_id`, `material_id`),
  KEY `idx_related_no` (`related_no`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='库存流水表';
```

**业务规则**：
- 每次库存变动都记录一条流水
- 记录变动前后的数量，便于对账
- 通过 related_no 关联到具体的入库单或出库单

### 4.4 消息通知模块

#### 4.4.1 消息表 (tb_message)

**表说明**：存储站内消息通知

```sql
CREATE TABLE `tb_message` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '消息ID',
  `user_id` BIGINT NOT NULL COMMENT '接收人ID',
  `title` VARCHAR(100) NOT NULL COMMENT '消息标题',
  `content` TEXT NOT NULL COMMENT '消息内容',
  `type` TINYINT NOT NULL DEFAULT 1 COMMENT '消息类型:1系统通知 2申请通知 3审批通知 4库存预警',
  `related_id` BIGINT DEFAULT NULL COMMENT '关联业务ID(申请单ID/出库单ID等)',
  `related_type` TINYINT DEFAULT NULL COMMENT '关联类型:1申请单 2出库单 3入库单',
  `is_read` TINYINT NOT NULL DEFAULT 0 COMMENT '是否已读:0未读 1已读',
  `read_time` DATETIME DEFAULT NULL COMMENT '阅读时间',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_read` (`user_id`, `is_read`),
  KEY `idx_type` (`type`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='消息表';
```

**消息类型枚举**：
- 1 = 系统通知（系统维护、功能更新）
- 2 = 申请通知（新申请、申请通过、申请拒绝）
- 3 = 审批通知（待审批提醒、超时提醒）
- 4 = 库存预警（低库存、缺货）

**消息模板示例**：

| 类型 | 标题 | 内容模板 |
|-----|------|---------|
| 申请提交 | 新申请待审批 | {申请人}提交了领用申请，申请单号：{申请单号}，请及时审批 |
| 申请通过 | 申请审批通过 | 您的申请已通过，申请单号：{申请单号}，请到{仓库}领取 |
| 申请拒绝 | 申请审批拒绝 | 您的申请已拒绝，申请单号：{申请单号}，拒绝原因：{原因} |
| 超时提醒 | 审批超时提醒 | 您有{数量}条申请待审批超过24小时，请及时处理 |
| 库存预警 | 库存预警 | {物资名称}库存不足，当前库存：{数量}，预警阈值：{阈值} |

### 4.5 系统日志模块

#### 4.5.1 操作日志表 (tb_operation_log)

**表说明**：记录用户操作行为，用于审计

```sql
CREATE TABLE `tb_operation_log` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `user_id` BIGINT DEFAULT NULL COMMENT '操作人ID',
  `username` VARCHAR(50) DEFAULT NULL COMMENT '操作人账号',
  `real_name` VARCHAR(50) DEFAULT NULL COMMENT '操作人姓名',
  `module` VARCHAR(50) NOT NULL COMMENT '操作模块(用户管理/入库管理/出库管理等)',
  `operation` VARCHAR(50) NOT NULL COMMENT '操作类型(新增/修改/删除/审批)',
  `method` VARCHAR(200) DEFAULT NULL COMMENT '请求方法',
  `request_url` VARCHAR(500) DEFAULT NULL COMMENT '请求URL',
  `request_method` VARCHAR(10) DEFAULT NULL COMMENT '请求方式(GET/POST/PUT/DELETE)',
  `request_params` TEXT DEFAULT NULL COMMENT '请求参数',
  `response_result` TEXT DEFAULT NULL COMMENT '响应结果',
  `ip` VARCHAR(50) DEFAULT NULL COMMENT 'IP地址',
  `location` VARCHAR(100) DEFAULT NULL COMMENT 'IP归属地',
  `browser` VARCHAR(50) DEFAULT NULL COMMENT '浏览器',
  `os` VARCHAR(50) DEFAULT NULL COMMENT '操作系统',
  `status` TINYINT NOT NULL DEFAULT 1 COMMENT '操作状态:0失败 1成功',
  `error_msg` TEXT DEFAULT NULL COMMENT '错误信息',
  `execute_time` INT DEFAULT NULL COMMENT '执行时长(毫秒)',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_module` (`module`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

**记录的操作类型**：
- 用户登录/登出
- 用户增删改
- 入库单创建
- 出库单创建
- 申请提交
- 审批操作（通过/拒绝）
- 库存调整
- 敏感配置修改

#### 4.5.2 登录日志表 (tb_login_log)

**表说明**：记录用户登录行为

```sql
CREATE TABLE `tb_login_log` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `user_id` BIGINT DEFAULT NULL COMMENT '用户ID',
  `username` VARCHAR(50) NOT NULL COMMENT '登录账号',
  `login_type` TINYINT NOT NULL DEFAULT 1 COMMENT '登录类型:1PC端 2小程序',
  `ip` VARCHAR(50) DEFAULT NULL COMMENT 'IP地址',
  `location` VARCHAR(100) DEFAULT NULL COMMENT 'IP归属地',
  `browser` VARCHAR(50) DEFAULT NULL COMMENT '浏览器',
  `os` VARCHAR(50) DEFAULT NULL COMMENT '操作系统',
  `status` TINYINT NOT NULL DEFAULT 1 COMMENT '登录状态:0失败 1成功',
  `message` VARCHAR(200) DEFAULT NULL COMMENT '提示信息',
  `login_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '登录时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_username` (`username`),
  KEY `idx_login_time` (`login_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='登录日志表';
```

---

## 5. 索引设计

### 5.1 索引设计原则

1. **主键索引**：所有表使用自增BIGINT作为主键
2. **唯一索引**：业务唯一字段（如用户名、单号、编码）
3. **普通索引**：高频查询字段、外键字段、状态字段
4. **联合索引**：多字段组合查询（注意最左前缀原则）
5. **避免过度索引**：索引会影响写入性能

### 5.2 关键索引列表

#### 5.2.1 用户表索引

```sql
-- 唯一索引
UNIQUE KEY uk_username (username)           -- 登录查询
UNIQUE KEY uk_phone (phone)                 -- 手机号查询
UNIQUE KEY uk_wechat_openid (wechat_openid) -- 小程序登录

-- 普通索引
KEY idx_dept_id (dept_id)                   -- 按部门查询用户
KEY idx_role_id (role_id)                   -- 按角色查询用户
KEY idx_status (status)                     -- 查询启用/禁用用户
```

#### 5.2.2 申请单表索引

```sql
-- 唯一索引
UNIQUE KEY uk_apply_no (apply_no)           -- 单号查询

-- 普通索引
KEY idx_applicant_id (applicant_id)         -- 查询我的申请
KEY idx_dept_id (dept_id)                   -- 部门管理员查询本部门申请
KEY idx_status (status)                     -- 查询待审批/已通过等
KEY idx_apply_time (apply_time)             -- 按时间范围查询
KEY idx_approver_id (approver_id)           -- 查询我审批的申请

-- 联合索引（根据实际查询优化）
KEY idx_dept_status (dept_id, status)       -- 部门+状态组合查询（高频）
KEY idx_status_time (status, apply_time)    -- 状态+时间范围查询
```

#### 5.2.3 出库单表索引

```sql
-- 唯一索引
UNIQUE KEY uk_outbound_no (outbound_no)

-- 普通索引
KEY idx_warehouse_id (warehouse_id)         -- 按仓库查询
KEY idx_apply_id (apply_id)                 -- 通过申请单查出库单
KEY idx_receiver_id (receiver_id)           -- 查询某人的领用记录
KEY idx_operator_id (operator_id)           -- 查询仓管操作记录
KEY idx_status (status)                     -- 查询待领取/已出库
KEY idx_outbound_time (outbound_time)       -- 按出库时间查询
KEY idx_create_time (create_time)           -- 按创建时间查询（超时检测）

-- 联合索引
KEY idx_status_create (status, create_time) -- 查询待领取且超时的出库单
```

#### 5.2.4 库存表索引

```sql
-- 唯一索引
UNIQUE KEY uk_warehouse_material (warehouse_id, material_id) -- 仓库+物资唯一

-- 普通索引
KEY idx_material_id (material_id)           -- 查询某物资在所有仓库的库存
KEY idx_quantity (quantity)                 -- 查询低库存（quantity <= min_stock）
```

#### 5.2.5 消息表索引

```sql
-- 联合索引（高频查询）
KEY idx_user_read (user_id, is_read)        -- 查询某用户的未读消息

-- 普通索引
KEY idx_type (type)                         -- 按消息类型查询
KEY idx_create_time (create_time)           -- 按时间查询（清理历史消息）
```

### 5.3 索引使用建议

**查询优化示例**：

```sql
-- ✅ 好的查询（使用索引）
SELECT * FROM tb_apply
WHERE dept_id = 1 AND status = 0
ORDER BY apply_time DESC;
-- 使用索引：idx_dept_status

-- ✅ 好的查询（使用索引）
SELECT * FROM tb_outbound
WHERE status = 0
  AND create_time < DATE_SUB(NOW(), INTERVAL 7 DAY);
-- 使用索引：idx_status_create

-- ❌ 不好的查询（全表扫描）
SELECT * FROM tb_apply
WHERE DATE(apply_time) = '2025-11-10';
-- 改进：WHERE apply_time >= '2025-11-10 00:00:00'
--       AND apply_time < '2025-11-11 00:00:00'

-- ❌ 不好的查询（函数导致索引失效）
SELECT * FROM tb_user WHERE LOWER(username) = 'admin';
-- 改进：WHERE username = 'admin' （数据库排序规则已不区分大小写）
```

---

## 6. 视图设计

### 6.1 库存汇总视图 (v_inventory_summary)

**视图说明**：汇总各仓库物资库存及状态

```sql
CREATE VIEW v_inventory_summary AS
SELECT
    i.id,
    i.warehouse_id,
    w.warehouse_name,
    w.dept_id,
    d.dept_name,
    i.material_id,
    m.material_name,
    m.material_code,
    m.category,
    m.spec,
    m.unit,
    i.quantity,
    i.locked_quantity,
    i.available_quantity,
    m.min_stock,
    CASE
        WHEN i.quantity = 0 THEN '缺货'
        WHEN i.quantity <= m.min_stock THEN '低库存'
        ELSE '正常'
    END AS stock_status,
    i.last_inbound_time,
    i.last_outbound_time,
    i.update_time
FROM tb_inventory i
INNER JOIN tb_warehouse w ON i.warehouse_id = w.id
INNER JOIN tb_dept d ON w.dept_id = d.id
INNER JOIN tb_material m ON i.material_id = m.id
WHERE w.is_deleted = 0 AND m.is_deleted = 0;
```

**使用场景**：
- 库存查询页面
- 库存预警统计
- 库存报表导出

### 6.2 申请审批视图 (v_apply_approval)

**视图说明**：申请单审批信息汇总

```sql
CREATE VIEW v_apply_approval AS
SELECT
    a.id,
    a.apply_no,
    a.applicant_id,
    a.applicant_name,
    a.applicant_phone,
    a.dept_id,
    a.dept_name,
    a.purpose,
    a.apply_time,
    a.status,
    CASE a.status
        WHEN 0 THEN '待审批'
        WHEN 1 THEN '已通过'
        WHEN 2 THEN '已拒绝'
        WHEN 3 THEN '已出库'
        WHEN 4 THEN '已取消'
    END AS status_name,
    a.approver_id,
    a.approver_name,
    a.approval_time,
    a.approval_opinion,
    a.reject_reason,
    a.outbound_id,
    o.outbound_no,
    o.status AS outbound_status,
    CASE
        WHEN a.status = 0 AND TIMESTAMPDIFF(HOUR, a.apply_time, NOW()) > 24 THEN 1
        ELSE 0
    END AS is_timeout,
    TIMESTAMPDIFF(HOUR, a.apply_time, a.approval_time) AS approval_duration,
    (SELECT COUNT(*) FROM tb_apply_detail WHERE apply_id = a.id) AS material_count,
    (SELECT SUM(quantity) FROM tb_apply_detail WHERE apply_id = a.id) AS total_quantity,
    a.create_time
FROM tb_apply a
LEFT JOIN tb_outbound o ON a.outbound_id = o.id;
```

**使用场景**：
- 待审批列表
- 我的申请列表
- 审批统计报表
- 超时审批检测

### 6.3 出入库统计视图 (v_inoutbound_stats)

**视图说明**：出入库统计分析

```sql
CREATE VIEW v_inoutbound_stats AS
SELECT
    DATE(create_time) AS stat_date,
    warehouse_id,
    'inbound' AS type,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_amount
FROM tb_inbound
WHERE status = 1
GROUP BY DATE(create_time), warehouse_id

UNION ALL

SELECT
    DATE(create_time) AS stat_date,
    warehouse_id,
    'outbound' AS type,
    COUNT(*) AS order_count,
    0 AS total_amount
FROM tb_outbound
WHERE status = 1
GROUP BY DATE(create_time), warehouse_id;
```

**使用场景**：
- 日/周/月统计报表
- 出入库趋势分析

---

## 7. 存储过程设计

### 7.1 生成单号存储过程 (sp_generate_order_no)

**存储过程说明**：生成入库单号、出库单号、申请单号

```sql
DELIMITER $$

CREATE PROCEDURE sp_generate_order_no(
    IN p_prefix VARCHAR(10),        -- 单号前缀(RK/CK/SQ)
    IN p_dept_code VARCHAR(10),     -- 部门编码
    OUT p_order_no VARCHAR(50)      -- 生成的单号
)
BEGIN
    DECLARE v_date VARCHAR(8);
    DECLARE v_seq INT;
    DECLARE v_seq_str VARCHAR(4);

    -- 获取当前日期(YYYYMMDD)
    SET v_date = DATE_FORMAT(NOW(), '%Y%m%d');

    -- 获取当天流水号（使用表锁保证并发安全）
    -- 这里简化处理，实际应使用专门的序列表
    SET v_seq = (
        SELECT COUNT(*) + 1
        FROM (
            SELECT inbound_no AS order_no FROM tb_inbound WHERE inbound_no LIKE CONCAT(p_prefix, '_', p_dept_code, '_', v_date, '%')
            UNION ALL
            SELECT outbound_no FROM tb_outbound WHERE outbound_no LIKE CONCAT(p_prefix, '_', p_dept_code, '_', v_date, '%')
            UNION ALL
            SELECT apply_no FROM tb_apply WHERE apply_no LIKE CONCAT(p_prefix, '_', p_dept_code, '_', v_date, '%')
        ) t
    );

    -- 格式化流水号为4位（0001、0002...）
    SET v_seq_str = LPAD(v_seq, 4, '0');

    -- 拼接单号：RK_WL_20251110_0001
    SET p_order_no = CONCAT(p_prefix, '_', p_dept_code, '_', v_date, '_', v_seq_str);
END$$

DELIMITER ;
```

**使用示例**：

```sql
CALL sp_generate_order_no('RK', 'WL', @order_no);
SELECT @order_no; -- RK_WL_20251110_0001
```

### 7.2 库存更新存储过程 (sp_update_inventory)

**存储过程说明**：更新库存并记录流水

```sql
DELIMITER $$

CREATE PROCEDURE sp_update_inventory(
    IN p_warehouse_id BIGINT,       -- 仓库ID
    IN p_material_id BIGINT,        -- 物资ID
    IN p_change_quantity DECIMAL(10,2), -- 变动数量(正数增加,负数减少)
    IN p_change_type TINYINT,       -- 变动类型:1入库 2出库
    IN p_related_no VARCHAR(50),    -- 关联单号
    IN p_related_type TINYINT,      -- 关联类型:1入库单 2出库单
    IN p_operator_id BIGINT,        -- 操作人ID
    IN p_operator_name VARCHAR(50), -- 操作人姓名
    OUT p_result INT                -- 返回结果:1成功 0失败(库存不足)
)
BEGIN
    DECLARE v_current_quantity DECIMAL(10,2);
    DECLARE v_material_name VARCHAR(100);
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SET p_result = 0;
    END;

    START TRANSACTION;

    -- 获取当前库存（行锁）
    SELECT quantity INTO v_current_quantity
    FROM tb_inventory
    WHERE warehouse_id = p_warehouse_id AND material_id = p_material_id
    FOR UPDATE;

    -- 出库时检查库存是否充足
    IF p_change_type = 2 AND v_current_quantity < ABS(p_change_quantity) THEN
        ROLLBACK;
        SET p_result = 0;
    ELSE
        -- 更新库存
        UPDATE tb_inventory
        SET quantity = quantity + p_change_quantity,
            last_inbound_time = IF(p_change_type = 1, NOW(), last_inbound_time),
            last_outbound_time = IF(p_change_type = 2, NOW(), last_outbound_time)
        WHERE warehouse_id = p_warehouse_id AND material_id = p_material_id;

        -- 获取物资名称
        SELECT material_name INTO v_material_name
        FROM tb_material
        WHERE id = p_material_id;

        -- 记录库存流水
        INSERT INTO tb_inventory_log(
            warehouse_id, material_id, material_name, change_type, change_quantity,
            before_quantity, after_quantity, related_no, related_type,
            operator_id, operator_name
        ) VALUES (
            p_warehouse_id, p_material_id, v_material_name, p_change_type, p_change_quantity,
            v_current_quantity, v_current_quantity + p_change_quantity, p_related_no, p_related_type,
            p_operator_id, p_operator_name
        );

        COMMIT;
        SET p_result = 1;
    END IF;
END$$

DELIMITER ;
```

**使用示例**：

```sql
-- 入库：增加100条光缆
CALL sp_update_inventory(1, 10, 100, 1, 'RK_WL_20251110_0001', 1, 1001, '张三', @result);

-- 出库：减少10条光缆
CALL sp_update_inventory(1, 10, -10, 2, 'CK_WL_20251110_0001', 2, 1001, '张三', @result);
```

---

## 8. 触发器设计

### 8.1 入库单明细触发器

**触发器说明**：入库单明细插入后自动计算金额并更新主单总金额

```sql
DELIMITER $$

-- 入库明细插入后触发器
CREATE TRIGGER tr_inbound_detail_after_insert
AFTER INSERT ON tb_inbound_detail
FOR EACH ROW
BEGIN
    -- 计算明细金额
    UPDATE tb_inbound_detail
    SET amount = NEW.quantity * NEW.unit_price
    WHERE id = NEW.id;

    -- 更新主单总金额
    UPDATE tb_inbound
    SET total_amount = (
        SELECT IFNULL(SUM(amount), 0)
        FROM tb_inbound_detail
        WHERE inbound_id = NEW.inbound_id
    )
    WHERE id = NEW.inbound_id;
END$$

DELIMITER ;
```

### 8.2 库存可用数量触发器

**触发器说明**：库存数量或锁定数量变化时自动计算可用数量

```sql
DELIMITER $$

CREATE TRIGGER tr_inventory_before_update
BEFORE UPDATE ON tb_inventory
FOR EACH ROW
BEGIN
    -- 自动计算可用数量
    SET NEW.available_quantity = NEW.quantity - NEW.locked_quantity;
END$$

DELIMITER ;
```

---

## 9. 数据字典

### 9.1 状态枚举

#### 9.1.1 用户状态 (tb_user.status)

| 值 | 说明 |
|----|------|
| 0 | 启用 |
| 1 | 禁用 |

#### 9.1.2 申请单状态 (tb_apply.status)

| 值 | 说明 | 备注 |
|----|------|------|
| 0 | 待审批 | 初始状态 |
| 1 | 已通过 | 审批通过，自动创建出库单 |
| 2 | 已拒绝 | 审批拒绝 |
| 3 | 已出库 | 员工已领取物资 |
| 4 | 已取消 | 员工撤销或超时取消 |

**状态流转**：
```
0(待审批) → 1(已通过) → 3(已出库)
0(待审批) → 2(已拒绝)
0(待审批) → 4(已取消)
1(已通过) → 4(已取消，超时未领取)
```

#### 9.1.3 出库单状态 (tb_outbound.status)

| 值 | 说明 | 备注 |
|----|------|------|
| 0 | 待领取 | 申请审批通过后创建，等待员工领取 |
| 1 | 已出库 | 直接出库(立即) 或 确认领取(申请流程) |
| 2 | 已取消 | 超时未领取自动取消 |

**状态流转**：
```
直接创建：创建 → 1(已出库，立即扣库存)
申请创建：创建 → 0(待领取) → 1(已出库，确认时扣库存)
超时取消：0(待领取) → 2(已取消，7天)
```

#### 9.1.4 入库单状态 (tb_inbound.status)

| 值 | 说明 |
|----|------|
| 1 | 已入库 |

*注：入库无需审批，创建即完成，故只有一个状态*

### 9.2 类型枚举

#### 9.2.1 入库类型 (tb_inbound.inbound_type)

| 值 | 说明 |
|----|------|
| 1 | 采购入库 |
| 2 | 退货入库 |
| 3 | 调拨入库 |
| 4 | 其他 |

#### 9.2.2 出库类型 (tb_outbound.outbound_type)

| 值 | 说明 |
|----|------|
| 1 | 领用出库 |
| 2 | 报废出库 |
| 3 | 调拨出库 |
| 4 | 其他 |

#### 9.2.3 出库来源 (tb_outbound.source)

| 值 | 说明 |
|----|------|
| 1 | 直接创建（仓管直接出库） |
| 2 | 申请自动创建（审批通过后） |

#### 9.2.4 消息类型 (tb_message.type)

| 值 | 说明 |
|----|------|
| 1 | 系统通知 |
| 2 | 申请通知 |
| 3 | 审批通知 |
| 4 | 库存预警 |

#### 9.2.5 角色级别 (tb_role.role_level)

| 值 | 说明 |
|----|------|
| 0 | 系统管理员 |
| 1 | 部门管理员 |
| 2 | 仓库管理员 |
| 3 | 普通员工 |

### 9.3 物资类别

| 类别 | 说明 | 常见物资 |
|------|------|---------|
| 光缆类 | 光纤通信线缆 | 光缆12芯、24芯、48芯 |
| 设备类 | 网络通信设备 | 交换机、路由器、OLT、ONU |
| 配件类 | 网络配件材料 | 网线、光纤跳线、配线架、机柜 |
| 工具类 | 施工维护工具 | 光纤熔接机、OTDR测试仪、网线钳 |

---

## 10. 备份与恢复策略

### 10.1 备份策略

**全量备份**：
- 频率：每天凌晨 2:00 执行
- 保留：最近 30 天的全量备份
- 工具：mysqldump 或 XtraBackup

```bash
# 全量备份脚本
#!/bin/bash
BACKUP_DIR="/data/backup/mysql"
DATE=$(date +%Y%m%d)
DATABASE="ct_tibet_wms"

mysqldump -u root -p${MYSQL_PASSWORD} \
  --single-transaction \
  --routines \
  --triggers \
  --events \
  ${DATABASE} | gzip > ${BACKUP_DIR}/${DATABASE}_full_${DATE}.sql.gz

# 删除30天前的备份
find ${BACKUP_DIR} -name "*.sql.gz" -mtime +30 -delete
```

**增量备份**：
- 频率：每小时执行一次
- 保留：最近 7 天的增量备份
- 方式：基于 binlog 的增量备份

```bash
# 增量备份脚本
#!/bin/bash
BINLOG_DIR="/var/lib/mysql"
BACKUP_DIR="/data/backup/binlog"
DATE=$(date +%Y%m%d_%H%M)

# 刷新binlog
mysql -u root -p${MYSQL_PASSWORD} -e "FLUSH LOGS"

# 复制最新的binlog
cp ${BINLOG_DIR}/mysql-bin.* ${BACKUP_DIR}/

# 压缩并删除7天前的binlog备份
find ${BACKUP_DIR} -name "mysql-bin.*" -mtime +7 -delete
```

### 10.2 恢复策略

**全量恢复**：

```bash
# 解压备份文件
gunzip ct_tibet_wms_full_20251110.sql.gz

# 恢复数据库
mysql -u root -p ${DATABASE} < ct_tibet_wms_full_20251110.sql
```

**增量恢复**：

```bash
# 恢复指定时间点的binlog
mysqlbinlog --start-datetime="2025-11-10 10:00:00" \
            --stop-datetime="2025-11-10 14:00:00" \
            mysql-bin.000001 mysql-bin.000002 | mysql -u root -p
```

### 10.3 数据归档策略

**历史数据归档**：

- 3年以上的历史数据迁移到归档库
- 归档表结构与业务表相同，添加 `_archive` 后缀
- 定期清理归档后的业务表数据

```sql
-- 归档3年前的出库单数据
INSERT INTO tb_outbound_archive
SELECT * FROM tb_outbound
WHERE create_time < DATE_SUB(NOW(), INTERVAL 3 YEAR);

-- 删除已归档数据
DELETE FROM tb_outbound
WHERE create_time < DATE_SUB(NOW(), INTERVAL 3 YEAR);

-- 归档出库明细
INSERT INTO tb_outbound_detail_archive
SELECT * FROM tb_outbound_detail
WHERE outbound_id IN (
    SELECT id FROM tb_outbound_archive
);
```

---

## 11. 性能优化建议

### 11.1 查询优化

**1. 分页查询优化**：

```sql
-- ❌ 不好的分页（深分页性能差）
SELECT * FROM tb_apply ORDER BY id DESC LIMIT 10000, 20;

-- ✅ 优化后的分页（使用主键定位）
SELECT * FROM tb_apply
WHERE id < #{lastId}
ORDER BY id DESC
LIMIT 20;
```

**2. 统计查询优化**：

```sql
-- ❌ 不好的统计（全表扫描）
SELECT COUNT(*) FROM tb_apply WHERE status = 0;

-- ✅ 优化方案1：使用覆盖索引
SELECT COUNT(id) FROM tb_apply WHERE status = 0;

-- ✅ 优化方案2：使用Redis缓存计数
-- 在申请单状态变更时更新Redis计数器
```

**3. 避免SELECT ***：

```sql
-- ❌ 不好的查询
SELECT * FROM tb_apply WHERE id = 1;

-- ✅ 只查询需要的字段
SELECT id, apply_no, applicant_name, status, apply_time
FROM tb_apply
WHERE id = 1;
```

### 11.2 表结构优化

**1. 字段类型优化**：

- 状态字段使用 TINYINT 而非 VARCHAR
- 金额字段使用 DECIMAL 而非 FLOAT/DOUBLE
- 时间字段使用 DATETIME 而非 VARCHAR

**2. 垂直分表**：

大字段（TEXT、BLOB）单独建表：

```sql
-- 主表（高频访问）
CREATE TABLE tb_apply (
    id BIGINT PRIMARY KEY,
    apply_no VARCHAR(50),
    applicant_id BIGINT,
    status TINYINT,
    apply_time DATETIME
    -- 不包含大字段
);

-- 扩展表（低频访问）
CREATE TABLE tb_apply_ext (
    apply_id BIGINT PRIMARY KEY,
    purpose TEXT,        -- 大字段
    remark TEXT,         -- 大字段
    approval_opinion TEXT
);
```

**3. 适度冗余**：

为减少JOIN，适当冗余常用字段：

```sql
-- 出库单表冗余领用人信息
CREATE TABLE tb_outbound (
    ...
    receiver_id BIGINT,
    receiver_name VARCHAR(50),  -- 冗余
    receiver_phone VARCHAR(20), -- 冗余
    ...
);
```

### 11.3 索引优化

**1. 联合索引顺序**：

```sql
-- ✅ 好的联合索引（区分度高的字段在前）
KEY idx_dept_status_time (dept_id, status, apply_time)

-- 可以使用该索引的查询：
-- WHERE dept_id = 1
-- WHERE dept_id = 1 AND status = 0
-- WHERE dept_id = 1 AND status = 0 AND apply_time > '2025-11-01'

-- ❌ 不能使用该索引的查询：
-- WHERE status = 0  （跳过了第一个字段）
-- WHERE apply_time > '2025-11-01' （跳过了前两个字段）
```

**2. 索引监控**：

```sql
-- 查询未使用的索引
SELECT
    t.TABLE_SCHEMA,
    t.TABLE_NAME,
    s.INDEX_NAME,
    s.COLUMN_NAME
FROM information_schema.STATISTICS s
JOIN information_schema.TABLES t ON s.TABLE_NAME = t.TABLE_NAME
WHERE t.TABLE_SCHEMA = 'ct_tibet_wms'
  AND s.INDEX_NAME NOT IN (
      SELECT DISTINCT INDEX_NAME
      FROM mysql.innodb_index_stats
  );

-- 查询重复索引
SELECT
    a.TABLE_NAME,
    a.INDEX_NAME AS index1,
    b.INDEX_NAME AS index2,
    a.COLUMN_NAME
FROM information_schema.STATISTICS a
JOIN information_schema.STATISTICS b
  ON a.TABLE_SCHEMA = b.TABLE_SCHEMA
  AND a.TABLE_NAME = b.TABLE_NAME
  AND a.SEQ_IN_INDEX = b.SEQ_IN_INDEX
  AND a.COLUMN_NAME = b.COLUMN_NAME
  AND a.INDEX_NAME <> b.INDEX_NAME
WHERE a.TABLE_SCHEMA = 'ct_tibet_wms';
```

### 11.4 缓存策略

**Redis缓存设计**：

```
key设计：
- user:{userId}                    用户信息（TTL: 30分钟）
- inventory:{warehouseId}:{materialId}  库存信息（TTL: 5分钟）
- apply:pending:count:{deptId}     待审批数量（实时更新）
- material:list:{category}         物资列表（TTL: 1小时）

更新策略：
- 用户信息：修改后删除缓存
- 库存信息：出入库后删除缓存
- 待审批数量：审批后更新计数器
- 物资列表：新增/修改物资后删除缓存
```

---

## 12. 附录

### 12.1 MySQL配置建议

```ini
[mysqld]
# 基础配置
port = 3306
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
default-time-zone = '+08:00'

# InnoDB配置
default-storage-engine = InnoDB
innodb_buffer_pool_size = 2G        # 建议设置为物理内存的50-70%
innodb_log_file_size = 512M
innodb_log_buffer_size = 16M
innodb_flush_log_at_trx_commit = 1  # 1=最安全，2=高性能
innodb_file_per_table = ON

# 连接配置
max_connections = 500
max_connect_errors = 1000

# 查询缓存（MySQL 5.7，8.0已移除）
query_cache_type = 0
query_cache_size = 0

# 慢查询日志
slow_query_log = ON
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# Binlog配置（用于主从复制和增量备份）
log_bin = mysql-bin
binlog_format = ROW
expire_logs_days = 7
```

### 12.2 数据初始化SQL

完整的数据初始化SQL脚本请见附件：`init_data.sql`

**包含内容**：
- 初始部门数据（8个部门）
- 初始角色数据（4个角色）
- 初始管理员账号（admin/123456）
- 示例物资数据（20个常用物资）
- 示例仓库数据（7个部门仓库）

### 12.3 建表SQL脚本

完整的建表SQL脚本请见附件：`schema.sql`

**执行顺序**：
```bash
# 1. 创建数据库
mysql -u root -p < create_database.sql

# 2. 创建表结构
mysql -u root -p ct_tibet_wms < schema.sql

# 3. 创建索引
mysql -u root -p ct_tibet_wms < create_indexes.sql

# 4. 创建视图
mysql -u root -p ct_tibet_wms < create_views.sql

# 5. 创建存储过程
mysql -u root -p ct_tibet_wms < create_procedures.sql

# 6. 初始化数据
mysql -u root -p ct_tibet_wms < init_data.sql
```

### 12.4 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|---------|
| v1.0 | 2025-11-11 | 技术团队 | 初始版本 |

---

**审批流程**：

| 角色 | 姓名 | 日期 | 签名 |
|------|------|------|------|
| 数据库设计师 | | | |
| 后端开发负责人 | | | |
| 技术负责人 | | | |
| 项目经理 | | | |

---

**文档结束**
